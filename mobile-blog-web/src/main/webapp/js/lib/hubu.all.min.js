(function(){var e,d,b;e="undefined"!==typeof global&&null!==global?global:this;e.HUBU=null!=(d=e.HUBU)?d:{};e.HUBU.extensions=null!=(b=e.HUBU.extensions)?b:{};e.hubu=function(){return e.HUBU};e.getHubuExtensions=function(){return HUBU.extensions};e.getGlobal=function(){return e}}).call(this);
(function(){HUBU.AbstractComponent=function(){function e(){}e.prototype.configure=function(){throw"AbstractComponent is an abstract class";};e.prototype.start=function(){throw"AbstractComponent is an abstract class";};e.prototype.stop=function(){throw"AbstractComponent is an abstract class";};e.prototype.getComponentName=function(){throw"AbstractComponent is an abstract class";};return e}()}).call(this);
(function(){var e,d,b,a=[].slice;HUBU.UTILS=null!=(e=HUBU.UTILS)?e:{};b=HUBU.UTILS;getGlobal().namespace=function(c,i,f){var b,d,g,e,l;3>arguments.length&&(b=["undefined"!==typeof exports?exports:window].concat(a.call(arguments)),c=b[0],i=b[1],f=b[2]);d=c;l=i.split(".");g=0;for(e=l.length;g<e;g++)b=l[g],c=c[b]||(c[b]={});return f(c,d)};getGlobal().Logger=e=function(){function c(){}c.DEBUG=0;c.INFO=1;c.WARNING=2;c.ERROR=3;c.prototype._header="";c.prototype._level=c.INFO;c.prototype._getConsole=function(){return null!=
("undefined"!==typeof window&&null!==window?window.console:void 0)?window.console:null!=("undefined"!==typeof global&&null!==global?global.console:void 0)?global.console:null};c.prototype.log=function(c){return null!=this._getConsole()?(this._getConsole().log(""+this._header+c),!0):!1};c.prototype.debug=function(i){return this._level<=c.DEBUG?this.log("DEBUG - "+i):!1};c.prototype.info=function(i){return this._level<=c.INFO?this.log("INFO - "+i):!1};c.prototype.warn=function(i){return this._level<=
c.WARNING?this.log("WARN - "+i):!1};c.prototype.error=function(i){if(this._level<=c.ERROR)return this.log("ERROR - "+i)};c.prototype.setLevel=function(c){return this._level=c};return c}();HUBU.logger=new e("hubu");d=HUBU.logger;getGlobal().Exception=function(){function c(c){this.message=c}c.prototype.data={};c.prototype.add=function(c,a){this.data.key=a;return this};c.prototype.toString=function(){return this.message};return c}();b.typeOf=function(c){var i,a,b,d,g;if(null==c)return new String(c);
i={};g="Boolean Number String Function Array Date RegExp".split(" ");b=0;for(d=g.length;b<d;b++)a=g[b],i["[object "+a+"]"]=a.toLowerCase();c=Object.prototype.toString.call(c);return c in i?i[c]:"object"};b.isObjectConformToContract=function(c,i){for(var a in i){if(null==c[a])return d.warn("Object not conform to contract - property "+a+" missing"),!1;if(this.typeOf(i[a])!==this.typeOf(c[a]))return d.warn("Object not conform to contract - the type of the property "+a+" does not match.          Expected '"+
this.typeOf(i[a])+"' but found '"+this.typeOf(c[a])+"'"),!1}return!0};b.isFunction=function(c){return"function"===this.typeOf(c)};b.isObject=function(c){return"object"===this.typeOf(c)};b.invoke=function(c,i,a){return null!=c[i]&&this.isFunction(c[i])?c[i].apply(c,a):!1};b.defineFunctionIfNotExist=function(c,i,a){return null==c[i]?(c[i]=a,!0):!1};b.clone=function(c,i){var a,b;if(null==c||"object"!==typeof c)return c;if(c instanceof Date)return new Date(c.getTime());if(c instanceof RegExp)return a=
"",null!=c.global&&(a+="g"),null!=c.ignoreCase&&(a+="i"),null!=c.multiline&&(a+="m"),null!=c.sticky&&(a+="y"),RegExp(c.source,a);b=new c.constructor;i=null!=i?i:[];for(a in c)-1===this.indexOf(i,a)&&(b[a]=this.clone(c[a],i));return b};b.bind=function(c,i){return function(){return i.apply(c,Array.prototype.slice.call(arguments))}};b.createProxyForContract=function(c,i){var a,b;b={};b.__proxy__=i;for(a in c)b[a]=this.isFunction(c[a])?this.bind(i,i[a]):i[a];return b};b.isComponent=function(c){return null==
c?!1:this.isObjectConformToContract(c,new HUBU.AbstractComponent)};b.isComponentPlugged=function(c,a){return"string"===this.typeOf(c)?null!==a.getComponent(c):"object"===this.typeOf(c)?-1!==this.indexOf(a.getComponents(),c):!1};b.indexOf=function(c,a){var b;if(null!=Array.prototype.indexOf)return c.indexOf(a);for(b in c)if(c.v===a)return b;return-1};b.removeElementFromArray=function(c,a){for(var b in c)c[b]===a&&c.splice(b,1);return c}}).call(this);
(function(){var e,d=[].slice;HUBU.Eventing=e=function(){function b(a){var c;this._hub=a;this._listeners=[];c=this;this._hub.getListeners=function(){return c._listeners};this._hub.registerListener=function(){var a,b;a=arguments[0];b=2<=arguments.length?d.call(arguments,1):[];2<=b.length?c.registerListener(a,b[0],b[1]):c.registerListener(a,b[1]);return this};this._hub.registerConfigurableListener=function(a,b){HUBU.logger.warn("registerConfigurableListener is a deprecated method and may disappear at any time, use registerListener instead");
c.registerListener(a,b);return this};this._hub.unregisterListener=function(a,b){c.unregisterListener(a,b);return this};this._hub.sendEvent=function(a,b){return c.sendEvent(a,b)};this._hub.subscribe=function(a,b,d,h){c.subscribe(a,b,d,h);return this};this._hub.unsubscribe=function(a,b){c.unsubscribe(a,b);return this};this._hub.publish=function(a,b,d){c.publish(a,b,d);return this}}b.prototype._hub=null;b.prototype._listeners=null;b.prototype._processEvent=function(a,c){var b,f,d,h,g,e;if(null==c||null==
a)return HUBU.logger.warn("Can't process event - component or event not defined"),!1;d=!1;e=this._listeners;h=0;for(g=e.length;h<g;h++)f=e[h],f.component!==a&&(b=HUBU.UTILS.clone(c),b.source=a,f.match.apply(f.component,[b])&&(f.callback.apply(f.component,[b]),d=!0));return d};b.prototype.registerListener=function(){var a,c,b,f;c=arguments[0];f=2<=arguments.length?d.call(arguments,1):[];a=b=null;switch(f.length){case 2:b=f[0];a=f[1];break;case 1:b=f[0].match,a=f[0].callback}if(null==c||null==b||null==
a)throw(new Exception("Cannot register event listener, component or match or callback is/are not defined")).add("component",c).add("match",b).add("callback",a);if(!HUBU.UTILS.isComponentPlugged(c,this._hub))throw new Exception("Cannot register event listener, the component is not plugged on the hub");return this._listeners.push({component:c,callback:a,match:b})};b.prototype.unregisterListener=function(a,c){var b,f,d,h,g,e;if(null==a)return HUBU.logger.warn("Cannot unregister listener - component not defined"),
!1;b=this.getComponent(a);if(null==b)return HUBU.logger.warn("Cannot unregister listener - component not plugged on the hub"),!1;d=[];if(null!=c){e=this._listeners;h=0;for(g=e.length;h<g;h++)f=e[h],f.component===b&&f.callback===c&&d.push(f)}else{e=this._listeners;h=0;for(g=e.length;h<g;h++)f=e[h],f.component===b&&d.push(f)}g=[];b=0;for(h=d.length;b<h;b++)f=d[b],g.push(this._listeners=HUBU.UTILS.removeElementFromArray(this._listeners,f));return g};b.prototype.getComponent=function(a){return"string"===
HUBU.UTILS.typeOf(a)?this._hub.getComponent(a):HUBU.UTILS.isComponent(a)?a:null};b.prototype.sendEvent=function(a,c){if(null==a||null==c)HUBU.logger.warn("Cannot send event, component or/and event are undefined");else return this._processEvent(a,c)};b.prototype.subscribe=function(a,c,b,d){var j;if(null==a||null==c||null==b)HUBU.logger.warn("Cannot subscribe to topic, component or/and topic and/or callback are undefined");else return j=RegExp(c),c=null,c=null==d||!HUBU.UTILS.isFunction(d)?function(c){return j.test(c.topic)}:
function(c){return j.test(c.topic)&&d(c)},this.registerListener(a,c,b)};b.prototype.unsubscribe=function(a,c){return this.unregisterListener(a,c)};b.prototype.publish=function(a,c,b){if(null==a||null==c||null==b)return HUBU.logger.info("Cannot publish event - component and/or topic and/or event are missing"),!1;b.topic=c;return this.sendEvent(a,b)};b.prototype.reset=function(){return this._listeners=[]};b.prototype.unregisterComponent=function(a){return this.unregisterListener(a)};return b}();getHubuExtensions().eventing=
e}).call(this);
(function(){var e;HUBU.Binding=e=function(){function d(b){var a;this._hub=b;a=this;this._hub.bind=function(c){a.bind(c);return this}}d.prototype._hub=null;d.prototype.getComponent=function(b){return"string"===HUBU.UTILS.typeOf(b)?this._hub.getComponent(b):HUBU.UTILS.isComponent(b)?b:null};d.prototype.getInjectedObject=function(b,a){if(null!=b.contract)if(HUBU.UTILS.isObjectConformToContract(a,b.contract)){if(null==b.proxy||b.proxy)return HUBU.UTILS.createProxyForContract(b.contract,a)}else throw(new Exception("Cannot bind components, the component is not conform to contract")).add("component",
a.getComponentName()).add("contract",b.contract);return a};d.prototype.bind=function(b){var a,c;if(null==b||!(null!=b&&b.to)||!(null!=b&&b.component)||!(null!=b&&b.into))throw new Exception("Cannot bind components - component, to and into must be defined");a=this.getComponent(b.component);if(null==a)throw(new Exception("Cannot bind components - 'component' is invalid")).add("component",b.component);c=this.getComponent(b.to);if(null==c)throw(new Exception("Cannot bind components - 'to' is invalid")).add("component",
b.to);a=this.getInjectedObject(b,a);switch(HUBU.UTILS.typeOf(b.into)){case "function":return b.into.apply(c,[a]);case "string":return null==c[b.into]?c[b.into]=a:HUBU.UTILS.isFunction(c[b.into])?c[b.into].apply(c,[a]):c[b.into]=a;default:throw(new Exception("Cannot bind components = 'into' must be either a function or a string")).add("into",b.into);}};return d}();getHubuExtensions().binding=e}).call(this);
(function(){var e,d,b;getGlobal().SOC=null!=(b=getGlobal().SOC)?b:{};e=getGlobal().SOC;e.ServiceRegistration=d=function(){function a(c,a,b,d,h,e){this._id=-1;if(null==a)throw new Exception("Cannot create a service registration without a valid component");if(null==b)throw new Exception("Cannot create a service registration without a valid service object");if(null==c)throw new Exception("Cannot create a service registration without a contract");if(null==h)throw new Exception("Cannot create a service registration without the hub");
if(null==e)throw new Exception("Cannot create a service registration without the registry");this._component=a;this._hub=h;this._contract=c;this._properties=null!=d?d:{};this._registry=e;this._svcObject=b;this._properties["service.contract"]=this._contract;this._properties["service.publisher"]=this._component}a._nextId=1;a.prototype._id=-1;a.prototype._component=null;a.prototype._contract=null;a.prototype._hub=null;a.prototype._registered=!1;a.prototype._properties={};a.prototype._reference=null;a.prototype._registry=
null;a.prototype._svcObject=null;a.getAndIncId=function(){var c;c=e.ServiceRegistration._nextId;e.ServiceRegistration._nextId+=1;return c};a.prototype.register=function(){if(!(HUBU.UTILS.isComponentPlugged(this._component,this._hub)||this._component===this._hub))throw new Exception("Invalid registration, the component is not plugged on the hub");this._id=e.ServiceRegistration.getAndIncId();this._reference=new e.ServiceReference(this);this._properties["service.id"]=this._id;this._registered=-1!==this._id;
return this._id};a.prototype.unregister=function(){return this._registered=!1};a.prototype.isRegistered=function(){return this._registered};a.prototype.getReference=function(){if(!(HUBU.UTILS.isComponentPlugged(this._component,this._hub)||this._component===this._hub))throw new Exception("Invalid lookup, the component is not plugged on the hub");return this._reference};a.prototype.getProperties=function(){return this._properties};a.prototype.getService=function(c){return!HUBU.UTILS.isFunction(this._svcObject)?
this._svcObject:this._svcObject.apply(this._component,[c])};a.prototype.setProperties=function(c){var a;a=null;this.isRegistered()&&(a=HUBU.UTILS.clone(this._properties,["service.contract","service.publisher"]),a=new e.ServiceRegistration(this._contract,this._component,this._svcObject,a,this._hub,this._registry),a._id=this._id,a._reference=new e.ServiceReference(a));this._properties=null!=c?c:{};this._properties["service.contract"]=this._contract;this._properties["service.publisher"]=this._component;
this._properties["service.id"]=this._id;if(this.isRegistered()&&null!=a)return c=new e.ServiceEvent(e.ServiceEvent.MODIFIED,this.getReference()),this._registry.fireServiceEvent(c,a.getReference())};return a}();e.ServiceReference=function(){function a(c){this._registration=c}a.prototype._registration=null;a.prototype.getContract=function(){return this._registration.getProperties()["service.contract"]};a.prototype.getProperties=function(){return this._registration.getProperties()};a.prototype.getProperty=
function(c){return this._registration.getProperties()[c]};a.prototype.getId=function(){return this._registration.getProperties()["service.id"]};a.prototype.isValid=function(){return this._registration.isRegistered};return a}();e.ServiceEvent=function(){function a(c,a){this._type=c;this._reference=a}a.REGISTERED=1;a.MODIFIED=2;a.UNREGISTERING=4;a.MODIFIED_ENDMATCH=8;a.prototype._type=0;a.prototype._reference=null;a.prototype.getReference=function(){return this._reference};a.prototype.getType=function(){return this._type};
return a}();e.ServiceRegistry=function(){function a(c){this._registrations=[];this._listeners=[];if(null==c)throw new Exception("Cannot initialize the service registry without a hub");this._hub=c}a.prototype._registrations=null;a.prototype._hub=null;a.prototype._listeners=null;a.prototype.getRegisteredServices=function(){var c,a,b,d,h,e,k,l;a=[];k=this._registrations;b=0;for(h=k.length;b<h;b++){c=k[b];l=c.registrations;d=0;for(e=l.length;d<e;d++)c=l[d],a.push(c.getReference())}return a};a.prototype._addRegistration=
function(c,a){var b,d,h,e,k;k=this._registrations;h=0;for(e=k.length;h<e;h++)d=k[h],d.component===c&&(b=d);null==b&&(b={component:c,registrations:[]},this._registrations.push(b));return b.registrations.push(a)};a.prototype._removeRegistration=function(c){var a,b,d,e,g;g=this._registrations;d=0;for(e=g.length;d<e;d++)b=g[d],-1!==HUBU.UTILS.indexOf(b.registrations,c)&&(a=b);if(null==a)return null;HUBU.UTILS.removeElementFromArray(a.registrations,c);0===a.registrations.length&&HUBU.UTILS.removeElementFromArray(this._registrations,
a);return a.component};a.prototype.registerService=function(c,a,b,j){if(null==a)throw new Exception("Cannot register a service without a proper contract");if(null==c)throw new Exception("Cannot register a service without a valid component");j=null!=j?j:c;if(!HUBU.UTILS.isFunction(j)&&!HUBU.UTILS.isObjectConformToContract(j,a))throw(new Exception("Cannot register service - the service object does not implement the contract")).add("contract",a).add("component",c);a=new d(a,c,null!=j?j:c,b,this._hub,
this);this._addRegistration(c,a);a.register();this.fireServiceEvent(new e.ServiceEvent(e.ServiceEvent.REGISTERED,a.getReference()));return a};a.prototype.unregisterService=function(c){var a;if(null==c)throw new Exception("Cannot unregister the service - invalid registration");if(null!=this._removeRegistration(c))return a=c.getReference(),c.unregister(),this.fireServiceEvent(new e.ServiceEvent(e.ServiceEvent.UNREGISTERING,a)),!0;throw new Exception("Cannot unregister service - registration not found");
};a.prototype.unregisterServices=function(c){var a,b,d,e,g;if(null==c)throw new Exception("Cannot unregister the services - invalid component");g=this._registrations;d=0;for(e=g.length;d<e;d++)b=g[d],b.component===c&&(a=b);if(null!=a){b=a.registrations;if(null!=b){d=0;for(e=b.length;d<e;d++)c=b[d],this.unregisterService(c)}return HUBU.UTILS.removeElementFromArray(this._registrations,a)}};a.prototype.getServiceReferences=function(c,a){return this._match(this._buildFilter(c,a))};a.prototype._match=
function(c){var a,b;b=this.getRegisteredServices();var d,e,g;g=[];d=0;for(e=b.length;d<e;d++)a=b[d],c.match(a)&&g.push(a);return g};a.prototype._buildFilter=function(c,a){var b;return null==c&&null==a?{match:function(){return!0}}:null!=c&&null==a?(b={},b.contract=c,b.match=function(a){return a.getProperty("service.contract")===b.contract},b):null!=c&&null!=a?(b={},b.contract=c,b.filter=a,b.match=function(a){return a.getProperty("service.contract")===b.contract&&b.filter(a)},b):{filter:a,match:function(a){return this.filter(a)}}};
a.prototype.getService=function(a,b){if(null==b)throw new Exception("Cannot get service - the reference is null");return!b.isValid()?(HUBU.logger.warn("Cannot retrieve service for "+b+" - the reference is invalid"),null):b._registration.getService(a)};a.prototype.ungetService=function(){};a.prototype.registerServiceListener=function(a){var b,d,j;b=a.contract;d=a.filter;j=a.listener;if(null==j)throw(new Exception("Can't register the service listener, the listener is not set")).add("listenerConfig",
a);a=this._buildFilter(b,d);b={listener:j,filter:a,contract:b};if(HUBU.UTILS.isObject(j)&&!HUBU.UTILS.isObjectConformToContract(j,e.ServiceListener))throw new Exception("Can't register the service listener, the listener is not conform to the Service Listener contract");return this._listeners.push(b)};a.prototype.unregisterServiceListener=function(a){var b,d,e,h,g,k;b=a.contract;d=a.listener;if(null==d)throw(new Exception("Can't unregister the service listener, the listener is not set")).add("listenerConfig",
a);g=this._listeners;k=[];e=0;for(h=g.length;e<h;e++)a=g[e],a.contract===b&&a.listener===d?k.push(HUBU.UTILS.removeElementFromArray(this._listeners,a)):k.push(void 0);return k};a.prototype.fireServiceEvent=function(a,b){var d,j,h,g,k,l;k=this._listeners;l=[];h=0;for(g=k.length;h<g;h++)d=k[h],(j=null==d.filter||this._testAgainstFilter(d,a.getReference()))?l.push(this._invokeServiceListener(d,a)):a.getType()===e.ServiceEvent.MODIFIED&&null!=b?this._testAgainstFilter(d,b)?(j=new e.ServiceEvent(e.ServiceEvent.MODIFIED_ENDMATCH,
a.getReference()),l.push(this._invokeServiceListener(d,j))):l.push(void 0):l.push(void 0);return l};a.prototype._testAgainstFilter=function(a,b){return a.filter.match(b)};a.prototype._invokeServiceListener=function(a,b){if(HUBU.UTILS.isFunction(a.listener))return a.listener(b);if(HUBU.UTILS.isObject(a.listener))return a.serviceChanged(b)};return a}()}).call(this);
(function(){var e;HUBU.ServiceComponent=function(){function d(b){this._component=b;this._providedServices=[];this._requiredServices=[];this._state=d.STOPPED}d.STOPPED=0;d.INVALID=1;d.VALID=2;d.prototype._component=null;d.prototype._providedServices=null;d.prototype._requiredServices=null;d.prototype._state=0;d.prototype.getComponent=function(){return this._component};d.prototype.getState=function(){return this._state};d.prototype.addProvidedService=function(b){if(-1===HUBU.UTILS.indexOf(this._providedServices,
b)){this._providedServices.push(b);b.setServiceComponent(this);if(this._state>d.STOPPED)b.onStart();if(this._state===d.VALID)b.onValidation();if(this._state===d.INVALID)return b.onInvalidation()}};d.prototype.removeProvidedService=function(b){if(-1!==HUBU.UTILS.indexOf(this._providedServices,b))return HUBU.UTILS.removeElementFromArray(this._providedServices,b),b.onStop()};d.prototype.addRequiredService=function(b){if(-1===HUBU.UTILS.indexOf(this._requiredServices,b)&&(this._requiredServices.push(b),
b.setServiceComponent(this),this._state>d.STOPPED))return b.onStart(),this.computeState()};d.prototype.removeRequiredService=function(b){if(-1<HUBU.UTILS.indexOf(this._requiredServices,b)&&(HUBU.UTILS.removeElementFromArray(this._requiredServices,b),b.onStop(),this._state>d.STOPPED))return this.computeState()};d.prototype.computeState=function(){var b,a,c,i,f;b=!0;f=this._requiredServices;c=0;for(i=f.length;c<i;c++)a=f[c],b=b&&a.isValid();a=this._state;this._state=b?d.VALID:d.INVALID;this._state>
a&&this._state===d.VALID?this._validate():this._state<a&&this._state===d.INVALID&&this._invalidate();return this._state};d.prototype._validate=function(){var b,a,c,d,f;HUBU.logger.debug("Validate instance "+(null!=(b=this._component)?b.getComponentName():void 0));d=this._providedServices;f=[];a=0;for(c=d.length;a<c;a++)b=d[a],f.push(b.onValidation());return f};d.prototype._invalidate=function(){var b,a,c,d,f;HUBU.logger.debug("Invalidate instance");d=this._providedServices;f=[];a=0;for(c=d.length;a<
c;a++)b=d[a],f.push(b.onInvalidation());return f};d.prototype.onStart=function(){var b,a,c,d;d=this._requiredServices;a=0;for(c=d.length;a<c;a++)b=d[a],b.onStart();d=this._providedServices;a=0;for(c=d.length;a<c;a++)b=d[a],b.onStart();return this.computeState()};d.prototype.onStop=function(){var b,a,c,i;i=this._providedServices;a=0;for(c=i.length;a<c;a++)b=i[a],b.onStop();i=this._requiredServices;a=0;for(c=i.length;a<c;a++)b=i[a],b.onStop();return this._state=d.STOPPED};d.prototype.getServiceDependencyByName=
function(b){var a,c,d,f;f=this._requiredServices;c=0;for(d=f.length;c<d;c++)if(a=f[c],a.getName()===b)return a};return d}();HUBU.ServiceDependency=function(){function d(b,a,c,d,f,e,h,g,k,l){var m;this._component=b;this._contract=a;this._filter=c;this._aggregate=d;this._optional=f;this._field=e;this._name=null!=k?k:this._contract;if(null!=h&&(this._bind=HUBU.UTILS.isFunction(h)?h:this._component[h],null==this._bind))throw new Exception("Bind method "+h+" not found on component");if(null!=g&&(this._unbind=
HUBU.UTILS.isFunction(g)?g:this._component[g],null==this._unbind))throw new Exception("Unbind method "+g+" not found on component");this._hub=l;this._state=HUBU.ServiceDependency.UNRESOLVED;this._refs=[];m=this;this._listener={contract:this._contract,filter:function(a){return a.getProperty("service.publisher")!==m._component&&(null==m._filter||m._filter(a))},listener:function(a){switch(a.getType()){case SOC.ServiceEvent.REGISTERED:return m._onServiceArrival(a.getReference());case SOC.ServiceEvent.MODIFIED:return m._onServiceModified(a.getReference());
case SOC.ServiceEvent.UNREGISTERING:return m._onServiceDeparture(a.getReference());case SOC.ServiceEvent.MODIFIED_ENDMATCH:return m._onServiceDeparture(a.getReference())}}}}d.UNRESOLVED=0;d.RESOLVED=1;d.prototype._component=null;d.prototype._contract=null;d.prototype._filter=null;d.prototype._aggregate=!1;d.prototype._optional=!1;d.prototype._field=null;d.prototype._bind=null;d.prototype._unbind=null;d.prototype._name=null;d.prototype._hub=null;d.prototype.setServiceComponent=function(b){return this._serviceComponent=
b};d.prototype.onStart=function(){this._state=HUBU.ServiceDependency.UNRESOLVED;this._startTracking();return this._computeDependencyState()};d.prototype.onStop=function(){this._stopTracking();this._ungetAllServices();this._refs=[];return this._state=HUBU.ServiceDependency.UNRESOLVED};d.prototype._ungetAllServices=function(){var b,a,c,d,f;d=this._refs;f=[];a=0;for(c=d.length;a<c;a++)b=d[a],null!=b.service&&(b.service=null,f.push(this._hub.ungetService(this._component,b.reference)));return f};d.prototype._startTracking=
function(){var b,a,c,d,f;this._hub.registerServiceListener(this._listener);a=this._hub.getServiceReferences(this._contract,this._filter);f=[];c=0;for(d=a.length;c<d;c++)b=a[c],f.push(this._onServiceArrival(b));return f};d.prototype._stopTracking=function(){return this._hub.unregisterServiceListener(this._listener)};d.prototype.isValid=function(){return this._state===HUBU.ServiceDependency.RESOLVED};d.prototype.getName=function(){return this._name};d.prototype.getContract=function(){return this._contract};
d.prototype.getFilter=function(){return this._filter};d.prototype.isAggregate=function(){return this._aggregate};d.prototype.isOptional=function(){return this._optional};d.prototype._computeDependencyState=function(){var b;b=this._state;this._state=this._optional||0<this._refs.length?HUBU.ServiceDependency.RESOLVED:HUBU.ServiceDependency.UNRESOLVED;if(b!==this._state)return this._serviceComponent.computeState()};d.prototype._onServiceArrival=function(b){var a,c,d,f,e;HUBU.logger.debug("Service arrival detected for "+
this._component.getComponentName());e=this._refs;d=0;for(f=e.length;d<f;d++)a=e[d],a.reference===b&&(c=a);if(null==c&&(c={reference:b,service:null},this._refs.push(c),this._computeDependencyState(),this._aggregate||1===this._refs.length))return this._inject(c)};d.prototype._onServiceDeparture=function(b){var a,c,d,f,e;HUBU.logger.debug("Service departure detected for "+this._component.getComponentName());e=this._refs;d=0;for(f=e.length;d<f;d++)a=e[d],a.reference===b&&(c=a);if(null!=c)if(HUBU.UTILS.removeElementFromArray(this._refs,
c),null!=c.service&&(this._deinject(c),this._hub.ungetService(this._component,b),c.service=null),0<this._refs.length){if(b=this._refs[0],!this._aggregate)return this._inject(b)}else return this._computeDependencyState()};d.prototype._onServiceModified=function(b){var a,c,d,f,e;e=this._refs;d=0;for(f=e.length;d<f;d++)a=e[d],a.reference===b&&(c=a);if(null==c)return this._onServiceArrival(b)};d.prototype._inject=function(b){var a;a=this._hub.getService(this._serviceComponent,b.reference);b.service=a;
null!=this._field&&this._aggregate&&(null==this._component[this._field]?this._component[this._field]=[a]:this._component[this._field].push(a));null!=this._field&&!this._aggregate&&(this._component[this._field]=a);if(null!=this._bind)return this._bind.apply(this._component,[a,b.reference])};d.prototype._deinject=function(b){null!=this._field&&this._aggregate&&HUBU.UTILS.removeElementFromArray(this._component[this._field],b.service);null!=this._field&&!this._aggregate&&(this._component[this._field]=
null);if(null!=this._unbind)return this._unbind.apply(this._component,[b.service,b.reference])};d.prototype.locateServices=function(){var b,a,c,d,f;c=[];a=this._hub.getServiceReferences(this._contract,this._filter);d=0;for(f=a.length;d<f;d++)b=a[d],c.push(this._hub.getService(this._component,b));return c};return d}();HUBU.ProvidedService=function(){function d(b,a,c,d,f,e,h,g){this._component=b;this._contract=a;this._hub=g;this._properties=c;if(null!=d&&(this._preRegistration=HUBU.UTILS.isFunction(d)?
d:this._component[d],null==this._preRegistration))throw new Exception("preRegistration method "+d+" not found on component");if(null!=f&&(this._postRegistration=HUBU.UTILS.isFunction(f)?f:this._component[f],null==this._postRegistration))throw new Exception("postRegistration method "+f+" not found on component");if(null!=e&&(this._preUnregistration=HUBU.UTILS.isFunction(e)?e:this._component[e],null==this._preUnregistration))throw new Exception("preUnregistration method "+e+" not found on component");
if(null!=h&&(this._postUnRegistration=HUBU.UTILS.isFunction(h)?h:this._component[h],null==this._postUnRegistration))throw new Exception("postUnregistration method "+h+" not found on component");}d.UNREGISTERED=0;d.REGISTERED=1;d.prototype._hub=null;d.prototype._contract=null;d.prototype._properties=null;d.prototype._registration=null;d.prototype._serviceComponent=null;d.prototype._component=null;d.prototype._preRegistration=null;d.prototype._postRegistration=null;d.prototype._preUnregistration=null;
d.prototype._postUnRegistration=null;d.prototype.setServiceComponent=function(b){return this._serviceComponent=b};d.prototype._register=function(){if(null!=this._registration)return!1;null!=this._preRegistration&&this._preRegistration.apply(this._component,[]);this._registration=this._hub.registerService(this._component,this._contract,this._properties,HUBU.UTILS.createProxyForContract(this._contract,this._component));HUBU.logger.debug("Service from "+this._component.getComponentName()+" registered");
null!=this._postRegistration&&this._postRegistration.apply(this._component,[this._registration]);return!0};d.prototype._unregister=function(){if(null==this._registration)return!1;null!=this._preUnregistration&&this._preUnregistration.apply(this._component,[this._registration]);this._hub.unregisterService(this._registration);this._registration=null;if(null!=this._postUnRegistration)return this._postUnRegistration.apply(this._component,[])};d.prototype.onStart=function(){};d.prototype.onStop=function(){return this._unregister()};
d.prototype.onValidation=function(){return this._register()};d.prototype.onInvalidation=function(){return this._unregister()};return d}();HUBU.ServiceOrientation=e=function(){function d(b){var a,c;this._hub=b;this._registry=new SOC.ServiceRegistry(this._hub);this._components=[];a=this._registry;c=this;this._hub.getServiceRegistry=function(){return a};this._hub.registerService=function(b,c,d,e){return a.registerService(b,c,d,e)};this._hub.unregisterService=function(b){return a.unregisterService(b)};
this._hub.getServiceReferences=function(b,c){return a.getServiceReferences(b,c)};this._hub.getServiceReference=function(b,c){var d;d=a.getServiceReferences(b,c);return 0!==d.length?d[0]:null};this._hub.getService=function(b,c){return a.getService(b,c)};this._hub.ungetService=function(b,c){return a.ungetService(b,c)};this._hub.registerServiceListener=function(b){return a.registerServiceListener(b)};this._hub.unregisterServiceListener=function(b){return a.unregisterServiceListener(b)};this._hub.requireService=
function(a){c.requireService(a);return this};this._hub.provideService=function(a){c.provideService(a);return this};this._hub.locateService=function(a,b){var d,e,g,k,l;l=c._components;g=0;for(k=l.length;g<k;g++)e=l[g],e.component===a&&(d=e);if(null==d)return null;e=d.serviceComponent.getServiceDependencyByName(b);if(null==e)throw new Exception("No dependency "+b+" on component "+d.component.getComponentName());d=e.locateServices();return null===d||0===d.length?null:d[0]};this._hub.locateServices=function(a,
b){var d,e,g,k,l;l=c._components;g=0;for(k=l.length;g<k;g++)e=l[g],e.component===a&&(d=e);if(null==d)return null;e=d.serviceComponent.getServiceDependencyByName(b);if(null==e)throw new Exception("No dependency "+b+" on component "+d.component.getComponentName());d=e.locateServices();return null===d||0===d.length?[]:d}}d.prototype._hub=null;d.prototype._registry=null;d.prototype._components=[];d.prototype.unregisterComponent=function(b){var a,c,d,e;e=this._components;c=0;for(d=e.length;c<d;c++)a=e[c],
null!=a&&a.component===b&&(a.serviceComponent.onStop(),HUBU.UTILS.removeElementFromArray(this._components,a));return this._registry.unregisterServices(b)};d.prototype.requireService=function(b){var a,c,d,e,j,h,g,k;d=b.component;e=b.contract;h=b.filter;a=b.aggregate;g=b.optional;j=b.field;c=b.bind;k=b.unbind;b=b.name;if(null==d)throw new Exception("Cannot require a service without a valid component");null==a&&(a=!1);null==g&&(g=!1);null==e&&(e=null);null==h&&(h=null);if(null==j&&null==c&&null==b)throw new Exception("Cannot require a service - field or bind must be set");
null==j&&(j=null);null==c&&(c=null);null==k&&(k=null);null==b&&(b=e);null==j&&null==c&&(g=!0);a=new HUBU.ServiceDependency(d,e,h,a,g,j,c,k,b,this._hub);return this._addServiceDependencyToComponent(d,a)};d.prototype.provideService=function(b){var a,c,d,e,j,h;a=b.component;c=b.contract;h=b.properties;e=b.preRegistration;d=b.postRegistration;j=b.preUnregistration;b=b.postUnregistration;if(null==a)throw new Exception("Cannot provided a service without a valid component");if(null==c)throw new Exception("Cannot provided a service without a valid contract");
null==h&&(h={});c=new HUBU.ProvidedService(a,c,h,e,d,j,b,this._hub);return this._addProvidedServiceToComponent(a,c)};d.prototype._addServiceDependencyToComponent=function(b,a){var c,d,e,j,h,g;e=!1;g=this._components;j=0;for(h=g.length;j<h;j++)d=g[j],d.component===b&&(c=d);null==c&&(c={component:b,serviceComponent:new HUBU.ServiceComponent(b)},this._components.push(c),e=!0);c.serviceComponent.addRequiredService(a);if(e&&this._hub.isStarted())return c.serviceComponent.onStart()};d.prototype._addProvidedServiceToComponent=
function(b,a){var c,d,e,j,h,g;e=!1;g=this._components;j=0;for(h=g.length;j<h;j++)d=g[j],d.component===b&&(c=d);null==c&&(c={component:b,serviceComponent:new HUBU.ServiceComponent(b)},this._components.push(c),e=!0);c.serviceComponent.addProvidedService(a);if(this._hub.isStarted()&&e)return c.serviceComponent.onStart()};d.prototype.start=function(){var b,a,c,d,e;d=this._components;e=[];a=0;for(c=d.length;a<c;a++)b=d[a],e.push(b.serviceComponent.onStart());return e};d.prototype.stop=function(){var b,
a,c,d,e;d=this._components;e=[];a=0;for(c=d.length;a<c;a++)b=d[a],e.push(b.serviceComponent.onStop());return e};return d}();getHubuExtensions().service=e}).call(this);
(function(){HUBU.Hub=function(){function e(){this._components=[];this._started=!1;this._extensions=null}e.prototype._components=null;e.prototype._started=!1;e.prototype._extensions=null;e.prototype._parentHub=null;e.prototype.configure=function(d){var b,a;null!=d&&(this._parentHub=d);if(null==this._extensions)for(b in this._extensions=[],a=getHubuExtensions(),a)d=a[b],this._extensions.push(new d(this));else HUBU.logger.debug("Hub already initialized");return this};e.prototype.getParentHub=function(){return this._parentHub};
e.prototype.getComponents=function(){return this._components};e.prototype.getComponent=function(d){var b,a,c,e,f;if(null==d)return null;f=this._components;c=0;for(e=f.length;c<e;c++)if(b=f[c],a=b.getComponentName,null!=a&&HUBU.UTILS.isFunction(a)&&(a=a.apply(b,[]),a===d))return b;return null};e.prototype.registerComponent=function(d,b){var a,c,e,f;if(null==d)throw new Exception("Cannot register component - component is null");if(!HUBU.UTILS.isComponent(d)){if(d.getComponentName)throw new Exception(d.getComponentName()+
" is not a valid component");throw new Exception(d+" is not a valid component");}null===this._extensions&&this.configure();if(null!=this.getComponent(d.getComponentName()))return HUBU.logger.info("Component "+d.getComponentName()+" already registered"),this;this._components.push(d);null!=b&&null!=b.component_name&&(d.__name__=b.component_name,d.getComponentName=function(){return this.__name__});null==d.__hub__&&null==d.hub&&(d.__hub__=this,d.hub=function(){return this.__hub__});HUBU.logger.debug("Registering component "+
d.getComponentName());f=this._extensions;c=0;for(e=f.length;c<e;c++)a=f[c],HUBU.UTILS.invoke(a,"registerComponent",[d,b]);HUBU.logger.debug("Configuring component "+d.getComponentName());d.configure(this,b);this._started&&(HUBU.logger.debug("Starting component "+d.getComponentName()),d.start());HUBU.logger.debug("Component "+d.getComponentName()+" registered");return this};e.prototype.unregisterComponent=function(d){var b,a,c,e,f;if(null==d)return this;if("string"===HUBU.UTILS.typeOf(d)){if(d=this.getComponent(d),
null==d)return this}else if(!HUBU.UTILS.isComponent(d))throw(new Exception("Cannot unregister component, it's not a valid component")).add("component",d);null===this._extensions&&this.configure();a=HUBU.UTILS.indexOf(this._components,d);if(-1!==a){f=this._extensions;c=0;for(e=f.length;c<e;c++)b=f[c],HUBU.UTILS.invoke(b,"unregisterComponent",[d]);d.stop();this._components.splice(a,1)}else HUBU.logger.info("Component "+d.getComponentName()+" not unregistered - not on the hub");return this};e.prototype.start=
function(){var d,b,a,c;if(this._started)return this;null===this._extensions&&this.configure();c=this._extensions;b=0;for(a=c.length;b<a;b++)d=c[b],HUBU.UTILS.invoke(d,"start",[]);this._started=!0;c=this._components;b=0;for(a=c.length;b<a;b++)d=c[b],d.start();return this};e.prototype.stop=function(){var d,b,a,c;if(!this._started)return this;this._started=!1;c=this._components;b=0;for(a=c.length;b<a;b++)d=c[b],d.stop();c=this._extensions;b=0;for(a=c.length;b<a;b++)d=c[b],HUBU.UTILS.invoke(d,"start",
[]);return this};e.prototype.isStarted=function(){return this._started};e.prototype.reset=function(){var d,b,a,c;this.stop();null===this._extensions&&this.configure();c=this._extensions;b=0;for(a=c.length;b<a;b++)d=c[b],HUBU.UTILS.invoke(d,"reset",[]);this._components=[];this._extensions=null;return this};e.prototype.getComponentName=function(){return"Hub"};return e}();getGlobal().hub=new HUBU.Hub}).call(this);